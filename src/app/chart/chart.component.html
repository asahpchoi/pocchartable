<mat-accordion>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Change
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div style="display: flex;width:100%;">
      <mat-card>
        <mat-card-title>Illustrated Scenario</mat-card-title>
        <button mat-raised-button (click)="setReturn('LOW');createChart();" [ngClass]="rtn=='LOW'?'hl':''"> Low </button>
        <button mat-raised-button (click)="setReturn('MEDIUM');createChart();" [ngClass]="rtn=='MEDIUM'?'hl':''"> Medium </button>
        <button mat-raised-button (click)="setReturn('HIGH');createChart();" [ngClass]="rtn=='HIGH'?'hl':''"> High </button>
      </mat-card>
      <mat-card>
        <mat-card-title>View</mat-card-title>
        <button mat-raised-button (click)="setView('AV');createChart();" [ngClass]="selectedView=='AV'?'hl':''"> Account Value </button>
        <button mat-raised-button (click)="setView('SV');createChart();" [ngClass]="selectedView=='SV'?'hl':''"> Surrender Value </button>
        <button mat-raised-button (click)="setView('DB');createChart();" [ngClass]="selectedView=='DB'?'hl':''"> Death Benefit </button>

      </mat-card>
      <mat-card>
        <mat-card-title>Opitonal Fields</mat-card-title>
        <button *ngFor="let f of avaliableFields" mat-raised-button (click)="updateOptionalFields(f)" [ngClass]="OptionalFields.includes(f)?'hl':''"> {{f}} </button>


      </mat-card>
      <mat-card>
        <mat-card-title>Base Plan</mat-card-title>
        <mat-form-field>
          <input matInput placeholder="Face Amount" [(ngModel)]="fm" type=number>
          <span matPrefix>$&nbsp;</span>
          <span matSuffix>.00</span>

        </mat-form-field>
        <mat-form-field>
          <input matInput placeholder="Planned Premium" [(ngModel)]="plannedPremium" type=number>
          <span matPrefix>$&nbsp;</span>
          <span matSuffix>.00</span>
        </mat-form-field>
        <mat-form-field>
          <input matInput placeholder="Insured Age" [(ngModel)]="age">
        </mat-form-field>
        <button mat-raised-button (click)="update()">update</button>
      </mat-card>
    </div>
    <mat-button-toggle (click)="toggleOrigin()">Hide Original Values</mat-button-toggle>
    <mat-button-toggle (click)="showSlider()">Show Slider</mat-button-toggle>
    <mat-button-toggle (click)="showTable=!showTable">Table/Chart</mat-button-toggle>
  </mat-expansion-panel>
</mat-accordion>



<mat-card>
  <div *ngIf="loading">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  <div style="width:100%;" [ngStyle]="{'display':showTable?'none':'block'}">


    <nouislider id="slider" style="" [connect]="true" [min]="0" [max]="maxIndex" [step]="1" [(ngModel)]="sliderValues"></nouislider>
    {{value}}
    <canvas id="canvas" (mousedown)="toggleOrigin()" >
    </canvas>

    <br>
    <table *ngIf="proposalData['Year']">
      <tr>
        <th class="sticky">
          Year/Age
        </th>
        <th >
          Premium Paid
        </th>
        <th>
          Account Value
        </th>
        <th> Topup </th>
        <th> Withdrawal </th>
        <th *ngFor="let f of OptionalFields">
          {{f}}
        </th>
      </tr>
      <tr *ngFor="let i of [0, this.sliderValues[0], this.sliderValues[1]]">
        <td class="sticky">{{proposalData["Year"][i]}} / {{proposalData["Age"][i]}}</td>
        <td  >{{proposalData["Total Premium"][i]| currency}}</td>
        <td>{{proposalData["Account Value (" + rtn + ")"][i] | currency}}</td>
        <td><input matInput [(ngModel)]="input.topup[i]" placeholder="topup" (click)="openDialog(input.topup, i)"> </td>
        <td><input matInput [(ngModel)]="input.withdrawal[i]" placeholder="withdrawal" (click)="openDialog(input.withdrawal, i)"></td>
        <td *ngFor="let f of OptionalFields">
          {{proposalData[f + " (" + rtn + ")"][i] | currency}}
        </td>
      </tr>
    </table>
  </div>
  <div style="width:100%;" [ngStyle]="{'display':!showTable?'none':'block'}">
    <table>
      <tr>
        <th>
          Year/Age
        </th>
        <th>
          Premium Paid
        </th>
        <th>
          Account Value
        </th>
        <th> Topup </th>
        <th> Withdrawal </th>
        <th *ngFor="let f of OptionalFields">
          {{f}}
        </th>
      </tr>

      <tr *ngFor="let i of getShowTable()">

        <td>{{proposalData["Year"][i - 1]}} / {{proposalData["Age"][i-1]}}</td>
        <td>{{proposalData["Total Premium"][i -1 ]| currency}}</td>
        <td>{{proposalData["Account Value (" + rtn + ")"][i -1] | currency}}</td>
        <td><input matInput [(ngModel)]="input.topup[i - 1]" placeholder="topup" (click)="openDialog(input.topup, i-1)"> </td>
        <td><input matInput [(ngModel)]="input.withdrawal[i - 1]" placeholder="withdrawal" (click)="openDialog(input.withdrawal, i-1)"></td>
        <td *ngFor="let f of OptionalFields">
          {{proposalData[f + " (" + rtn + ")"][i - 1] | currency}}
        </td>

      </tr>
    </table>

  </div>




</mat-card>
<pre>
{{getInput() | json}}
</pre>
<div class="example-container mat-elevation-z8">
  <mat-table #table [dataSource]="dataSource">
    <ng-container matColumnDef="{{c}}" *ngFor="let c of displayedColumns">
      <mat-header-cell *matHeaderCellDef> {{c}} </mat-header-cell>
      <mat-cell *matCellDef="let element"> {{element[c]}} </mat-cell>
    </ng-container>
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
  </mat-table>
</div>
